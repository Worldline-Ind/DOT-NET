@{
    ViewBag.Title = "Home Page";
}

<html>

<head>
    <title>Checkout Demo</title>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1" />

    <script src="https://www.paynimo.com/paynimocheckout/client/lib/jquery.min.js" type="text/javascript"></script>

    <style>
        .show {
            display: table-row !important;
            vertical-align: inherit;
            border-color: inherit;
            width: 100vw;
        }

        .hid {
            display: none;
        }
        td {
            padding: 0px;
           
            margin: 0px;
        }
        </style>

</head>

<body>
    <h1>Online Transaction</h1>

    <form id="form" action="#" accept-charset="UTF-8" method="post">
        <input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" id="authenticity_token" value="" />
                                                            <table border="1" cellpadding="2" cellspacing="0">
                                                                <tbody>
                                                                    <tr>
                                                                        <td> <label for="Merchant_Code">Merchant code</label> </td>
                                                                        <td> <input type="text" name="mrctCode" id="mrctCode" value="T3348" /></td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Transaction_ID">Transaction id</label> </td>
                                                                        <td> <input type="text" name="txn_id" id="txn_id" value="@ViewBag.tranId" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Amount">Amount</label> </td>
                                                                        <td> <input type="text" name="amount" id="amount" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Scheme">Scheme</label> </td>
                                                                        <td> <input type="text" name="scheme" id="scheme" value="test" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Customer_ID">Customer id</label>	</td>
                                                                        <td> <input type="text" name="custID" id="custID" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Mobile_Number">Mobile number</label> </td>
                                                                        <td> <input type="text" name="mobNo" id="mobNo" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Email">Email</label> </td>
                                                                        <td> <input type="email" name="email" id="email" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Customer_Name">Customer name</label> </td>
                                                                        <td> <input type="text" name="name" id="name" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Currency">Currency</label> </td>
                                                                        <td> <input type="text" name="currency" id="currency" value="INR" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="SALT">Salt</label> </td>
                                                                        <td> <input type="text" name="SALT" id="SALT" value="1496899267KMOWJE" /> </td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td> <label for="Return_Url">Return url</label> </td>
                                                                        <td> <input type="text" name="returnUrl" id="returnUrl" value="http://192.168.0.78:3000/response/response-handler" /> </td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td> <label for="accNo">Account No</label> </td>
                                                                        <td><input type="text" id="accNo" name="accNo" /> </td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="accountType">Account Type</label></td>
                                                                        <td>
                                                                            <select id="accountType" name="accountType" style="width:100%">
                                                                                <option value="Saving">Saving</option>
                                                                                <option value="Current">Current</option>
                                                                            </select>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="accountHolderName">Account Name</label></td>
                                                                        <td><input type="text" id="accountHolderName" name="accountHolderName" /> </td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="aadharNo">Aadhar No</label></td>
                                                                        <td><input type="text" id="aadharNo" name="aadharNo" /> </td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="ifscCode">IFSC Code</label></td>
                                                                        <td><input type="text" id="ifscCode" name="ifscCode" /></td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="debitStartDate">Debit Start Date</label></td>
                                                                        <td><input type="date" id="debitStartDate" name="debitStartDate" value="@ViewBag.debitStartDate" style="width:100%" /></td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="debitEndDate">Debit End Date</label></td>
                                                                        <td><input type="date" id="debitEndDate" name="debitEndDate" value="@ViewBag.debitEndDate" style="width:100%"/></td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="maxAmount">Max Amount</label></td>
                                                                        <td><input type="text" id="maxAmount" name="maxAmount" /></td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label for="amountType">Amount Type</label></td>
                                                                        <td>
                                                                            <select id="amountType" name="amountType" style="width:100%">
                                                                                <option value="M">Variable</option>
                                                                                <option value="F">Fixed</option>
                                                                            </select>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="@(ViewBag.enbSi ? Html.Raw("show") : Html.Raw("hid"))">
                                                                        <td><label>Frequency</label></td>
                                                                        <td>
                                                                            <select id="frequency"  name="frequency" style="width:100%">
                                                                                <option value="ADHO" selected> As and when presented </option>
                                                                                <option value="DAIL"> Daily </option>
                                                                                <option value="WEEK"> Weekly </option>
                                                                                <option value="MNTH"> Monthly </option>
                                                                                <option value="BIMN"> Bi- monthly </option>
                                                                                <option value="QURT"> Quarterly </option>
                                                                                <option value="MIAN"> Semi annually </option>
                                                                                <option value="YEAR"> Yearly </option>
                                                                            </select>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>

        @*<input type="hidden" name="accNo" id="accNo" />
        <input type="hidden" name="debitStartDate" id="debitStartDate" value="@ViewBag.debitStartDate" />
        <input type="hidden" name="debitEndDate" id="debitEndDate" value="@ViewBag.debitEndDate" />
        <input type="hidden" name="maxAmount" id="maxAmount" value="" />
        <input type="hidden" name="amountType" id="amountType" value="M"/>
        <input type="hidden" name="frequency" id="frequency" value="ADHO" />*@
        <input type="hidden" name="cardNumber" id="cardNumber" />
        <input type="hidden" name="expMonth" id="expMonth" />
        <input type="hidden" name="expYear" id="expYear" />
        <input type="hidden" name="cvvCode" id="cvvCode" />
        <input type="hidden" name="config_data" id="config_data" value="" />

        <div><input type="submit" name="commit" value="Save" id="btnSubmit" data-disable-with="Save" /></div>
        <div id="ingenico_embeded_popup"></div>

       
    </form>

    <script type="text/javascript" src="https://www.paynimo.com/Paynimocheckout/server/lib/checkout.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            function handleResponse(res) {
                if (typeof res != 'undefined' && typeof res.paymentMethod != 'undefined' && typeof res.paymentMethod.paymentTransaction != 'undefined' && typeof res.paymentMethod.paymentTransaction.statusCode != 'undefined' && res.paymentMethod.paymentTransaction.statusCode == '0300') {
                    // success block
                    alert("success");
                } else if (typeof res != 'undefined' && typeof res.paymentMethod != 'undefined' && typeof res.paymentMethod.paymentTransaction != 'undefined' && typeof res.paymentMethod.paymentTransaction.statusCode != 'undefined' && res.paymentMethod.paymentTransaction.statusCode == '0398') {
                    // initiated block
                    alert("initiated");
                } else {
                    // error block
                    alert("error");
                }
            };

            function formatDate(date) {
                var d = new Date(date),
                    month = '' + (d.getMonth() + 1 ),
                    day = '' + d.getDate(),
                    year = d.getFullYear();

                if (month.length < 2)
                    month = '0' + month;
                if (day.length < 2)
                    day = '0' + day;
              //  alert([day, month, year].join('-'));
                return [day, month, year].join('-');
            };



            $(document).off('click', '#btnSubmit').on('click', '#btnSubmit', function (e) {
                e.preventDefault();
                var jsonVals = JSON.parse('@Html.Raw(ViewBag.config_data)');
              //  alert(jsonVals['disclaimerMessage']);
          //      alert(document.getElementById("mrctCode").value);
                var maxAmt = document.getElementById("amount").value*2 ;
              //  alert(maxAmt);
                //document.getElementById("maxAmount").value
                var inputString = document.getElementById("mrctCode").value + "|" + document.getElementById("txn_id").value + "|" + document.getElementById("amount").value + "|" + document.getElementById("accNo").value + "|" + document.getElementById("custID").value + "|" + document.getElementById("mobNo").value + "|" + document.getElementById("email").value + "|" + formatDate(document.getElementById("debitStartDate").value) + "|" + formatDate(document.getElementById("debitEndDate").value) + "|" + maxAmt + "|" + document.getElementById("amountType").value + "|" + document.getElementById("frequency").value + "|" + document.getElementById("cardNumber").value + "|" + document.getElementById("expMonth").value + "|" + document.getElementById("expYear").value + "|" + document.getElementById("cvvCode").value + "|" + document.getElementById("SALT").value;

                var clientStuff = "";
                

$.ajax({
    type: 'GET',
    url: '@Url.Action("GenerateSHA512String", "Home")',
    data: { inputString: inputString},
    dataType: "json",
    cache: false,
    async: false,
    success: function (data) {
        clientStuff = data;
        document.getElementById("authenticity_token").value = clientStuff;
        jsonVals['authenticity_token'] = clientStuff;
        var myJSON = JSON.stringify(jsonVals);
        document.getElementById("config_data").value = myJSON;
      //  alert(formatDate(document.getElementById("debitEndDate").value));
      //  alert(document.getElementById("config_data").value);
    },
    error: function(errorMsg) {
        alert(errorMsg);
    }
                });
                const valueB = 'false';

                var pgrMsg = (jsonVals['showPGResponseMsg'] == valueB) ? false : (jsonVals['showPGResponseMsg'] != valueB) ? true : true;
                var abrtResp = (jsonVals['enableAbortResponse'] == valueB) ? false : (jsonVals['enableAbortResponse'] != valueB) ? true : true;
                var expPay = (jsonVals['enableExpressPay'] == valueB) ? false : (jsonVals['enableExpressPay'] != valueB) ? true : true;
                var newWinFlow = (jsonVals['enableNewWindowFlow'] == valueB) ? false : (jsonVals['enableNewWindowFlow'] != valueB) ? true : true;

                var paymentModeOrder = jsonVals['paymentModeOrder'].replace(" ", "");
                var paymentModeOrderArr = paymentModeOrder.split(",");
                var embdPmntGtway = (jsonVals['embedPaymentGatewayOnPage'] == valueB) ? "" : (jsonVals['enableNewWindowFlow'] != valueB) ? "#ingenico_embeded_popup" : "";
                var configJson = {
                    "tarCall": false,
                    "features": {
                        "showPGResponseMsg": pgrMsg,
                        "enableAbortResponse": abrtResp,
                        "enableExpressPay": expPay,
                        "enableNewWindowFlow": newWinFlow,
                        "enableDebitDay":true,
                        "siDetailsAtMerchantEnd": (jsonVals['siDetailsAtMerchantEnd'] == valueB) ? false : (jsonVals['siDetailsAtMerchantEnd'] != valueB) ? true : true,
                        "enableSI": (jsonVals['enableSI'] == valueB) ? false : (jsonVals['enableSI'] != valueB) ? true : true
                    },
                    "consumerData":
                    {
                        "deviceId": "WEBSH2",
                        "token": clientStuff,
                        "returnUrl": "/Response/responseHandler",
                        "paymentMode": jsonVals['paymentMode'],
                        "paymentModeOrder": paymentModeOrderArr,
                        "checkoutElement": embdPmntGtway,
                        "merchantLogoUrl": "https://www.paynimo.com/CompanyDocs/company-logo-md.png",
                        "merchantId": document.getElementById("mrctCode").value,
                        "merchantMsg": jsonVals['merchantMessage'],
                        "disclaimerMsg": jsonVals['disclaimerMessage'],
                        "currency": document.getElementById("currency").value,
                        "consumerId": document.getElementById("custID").value,
                        "consumerMobileNo": document.getElementById("mobNo").value,
                        "consumerEmailId": document.getElementById("email").value,
                        "txnId": document.getElementById("txn_id").value,
                        "items": [{
                            "itemId": document.getElementById("scheme").value,
                            "amount": document.getElementById("amount").value, "comAmt": "0"
                        }],
                        "customStyle":
                        {
                            "PRIMARY_COLOR_CODE": jsonVals['primaryColor'],
                            "SECONDARY_COLOR_CODE": jsonVals['secondaryColor'],
                            "BUTTON_COLOR_CODE_1": jsonVals['buttonColor1'],
                            "BUTTON_COLOR_CODE_2": jsonVals['buttonColor2']
                        },
                        "debitStartDate": formatDate(document.getElementById("debitStartDate").value),
                        "debitEndDate": formatDate(document.getElementById("debitEndDate").value),
                        "maxAmount": maxAmt,
                        "amountType": "M",
                        "frequency": "ADHO"
                    }
                }

                var myJSON = JSON.stringify(configJson);
            //    document.getElementById("test34").innerText = myJSON;

            //    console.log(myJSON);

           //     alert(configJson);
                $.pnCheckout(configJson);
                if (configJson.features.enableNewWindowFlow) {
                    pnCheckoutShared.openNewWindow();
                }
            });
        });
    </script>
    <div id="test34"></div>
</body>

</html>
